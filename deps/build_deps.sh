#!/bin/sh

set -e

if [ "$1" = clean ] ; then
    if [ ! -z "$DEPS_BUILD_DIR" ] ; then
        rm -rf "$DEPS_BUILD_DIR"/*
    fi
    exit
fi

if [ -d /usr/local/opt/ccache/libexec ] ; then
    CC=/usr/local/opt/ccache/libexec/clang
    CXX=/usr/local/opt/ccache/libexec/clang++
else
    CC=clang
    CXX=clang++
fi

if [ "$CONFIGURATION" = "Debug" ] ; then
    cflags_config="-O2 -ggdb3"
    ldflags_config="-O2 -ggdb3"
else
    cflags_config="-O2"
    ldflags_config=""
fi

cat <<EOT >build.vars.local.ninja
# Generated by Xcode on `date`
SDKROOT = $SDKROOT
MACOSX_DEPLOYMENT_TARGET = $MACOSX_DEPLOYMENT_TARGET
CONFIGURATION = $CONFIGURATION

top_srcdir = `pwd`
builddir = $DEPS_BUILD_DIR

cc = $CC
cxx = $CXX

cflags_config = $cflags_config
ldflags_config = $ldflags_config
EOT

ninja
